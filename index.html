<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow, noarchive, nosnippet">
    <title>Pixel Shooting Range - GA4 E-Commerce Event Tester</title>
    <script>
        (function() {
            window.dataLayer = window.dataLayer || [];
            var beforeConsent = sessionStorage.getItem('psr_ecommerce_before_consent') !== 'false';
            if (!beforeConsent) return;

            var payload = sessionStorage.getItem('psr_pending_ecommerce_payload');
            if (!payload) return;

            try {
                var data = JSON.parse(payload);
                window.dataLayer.push(data);
                sessionStorage.removeItem('psr_pending_ecommerce_payload');
                sessionStorage.setItem('psr_ecommerce_early_fired', 'true');
                console.log('%c[Early DataLayer Push] vor CMP/GTM', 'color: #ff9800; font-weight: bold;', data);
            } catch(e) {}
        })();
    </script>
    <!-- SNIPPET:HEAD -->
    <script>
        (function() {
            var fakeReferrer = sessionStorage.getItem('psr_fake_referrer');
            if (fakeReferrer) {
                sessionStorage.removeItem('psr_fake_referrer');
                Object.defineProperty(document, 'referrer', {
                    get: function() { return fakeReferrer; }
                });
                console.log('%c[Referrer Override] document.referrer = ' + fakeReferrer, 'color: #e91e63; font-weight: bold;');
            }
        })();
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rye&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- SNIPPET:BODY -->
    <div class="scene-container" id="scene">
        <button class="sign-btn" data-event="page_view">
            <span class="sign-emoji">ğŸ“„</span>
            <span class="sign-label">page_view</span>
        </button>
        <button class="sign-btn" data-event="view_item_list">
            <span class="sign-emoji">ğŸ“‹</span>
            <span class="sign-label">view_item_list</span>
        </button>
        <button class="sign-btn" data-event="view_item">
            <span class="sign-emoji">ğŸ”</span>
            <span class="sign-label">view_item</span>
        </button>
        <button class="sign-btn" data-event="select_item">
            <span class="sign-emoji">ğŸ‘†</span>
            <span class="sign-label">select_item</span>
        </button>
        <button class="sign-btn" data-event="add_to_cart">
            <span class="sign-emoji">ğŸ›’</span>
            <span class="sign-label">add_to_cart</span>
        </button>
        <button class="sign-btn" data-event="remove_from_cart">
            <span class="sign-emoji">âŒ</span>
            <span class="sign-label">remove_from_cart</span>
        </button>
        <button class="sign-btn" data-event="begin_checkout">
            <span class="sign-emoji">ğŸ›ï¸</span>
            <span class="sign-label">begin_checkout</span>
        </button>
        <button class="sign-btn" data-event="add_shipping_info">
            <span class="sign-emoji">ğŸšš</span>
            <span class="sign-label">add_shipping_info</span>
        </button>
        <button class="sign-btn" data-event="add_payment_info">
            <span class="sign-emoji">ğŸ’³</span>
            <span class="sign-label">add_payment_info</span>
        </button>
        <button class="sign-btn" data-event="purchase">
            <span class="sign-emoji">ğŸ’°</span>
            <span class="sign-label">purchase</span>
        </button>
        <button class="sign-btn sign-btn-special" data-event="purchase_payment_provider">
            <span class="sign-emoji">ğŸ’³</span>
            <span class="sign-label">purchase payment_provider</span>
        </button>
    </div>

    <div class="toolbar-right">
        <button class="toolbar-btn config-btn" id="configBtn" title="GTM/CMP Konfiguration">
            <span class="config-icon">âš™</span>
            <span class="config-status" id="configStatus"></span>
        </button>
        <button class="toolbar-btn simulator-btn" id="simulatorBtn" title="Traffic Simulator">
            <span class="simulator-icon">ğŸ¤–</span>
        </button>
        <button class="toolbar-btn sound-btn" id="soundBtn" title="Sound ein/aus">ğŸ”Š</button>
        <button class="toolbar-btn session-btn" id="sessionBtn" title="Neue GA4 Session">ğŸ”„</button>
    </div>

    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <h2 class="modal-title">GTM / CMP Konfiguration</h2>
            <div class="modal-field">
                <label for="gtmSnippet">Google Tag Manager Snippet:</label>
                <textarea id="gtmSnippet" placeholder="FÃ¼ge hier deinen GTM Container-Snippet ein..."></textarea>
            </div>
            <div class="modal-field">
                <label for="cmpSnippet">CMP Snippet (optional):</label>
                <textarea id="cmpSnippet" placeholder="FÃ¼ge hier deinen Consent Management Platform Snippet ein..."></textarea>
            </div>
            <div class="modal-field modal-field-toggle">
                <label class="toggle-label" for="spaToggle">
                    <span class="toggle-text">Single Page Application (SPA) Modus</span>
                    <span class="toggle-hint">Wenn aktiv, werden alle Events ohne Page Reload gefeuert</span>
                </label>
                <label class="toggle-switch">
                    <input type="checkbox" id="spaToggle">
                    <span class="toggle-slider"></span>
                </label>
            </div>
            <div class="modal-field modal-field-toggle">
                <label class="toggle-label" for="consentTimingToggle">
                    <span class="toggle-text">E-Commerce DataLayer vor Einwilligung</span>
                    <span class="toggle-hint">Wenn aktiv, erscheinen E-Commerce Events im DataLayer bevor CMP/GTM laden (Shop-typisch)</span>
                </label>
                <label class="toggle-switch">
                    <input type="checkbox" id="consentTimingToggle" checked>
                    <span class="toggle-slider"></span>
                </label>
            </div>
            <div class="modal-actions">
                <button class="modal-btn btn-apply" id="btnApply">Anwenden</button>
                <button class="modal-btn btn-clear" id="btnClear">LÃ¶schen</button>
                <button class="modal-btn btn-close" id="btnClose">SchlieÃŸen</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="simModalOverlay">
        <div class="modal sim-modal">
            <h2 class="modal-title">Traffic Simulator</h2>
            <p class="sim-description">
                Startet automatische Browser-Sessions, die GA4 E-Commerce Events simulieren.
                Die konfigurierten GTM/CMP Snippets werden verwendet.
            </p>
            <div class="modal-field">
                <label for="simSessions">Anzahl Sessions (1-50):</label>
                <input type="number" id="simSessions" min="1" max="50" value="10">
            </div>
            <div class="sim-progress-container" id="simProgressContainer" style="display: none;">
                <div class="sim-progress-bar-bg">
                    <div class="sim-progress-bar" id="simProgressBar"></div>
                </div>
                <div class="sim-progress-text" id="simProgressText"></div>
            </div>
            <div class="sim-status" id="simStatusText"></div>
            <div class="modal-actions">
                <button class="modal-btn btn-apply" id="simStartBtn">Starten</button>
                <button class="modal-btn btn-clear" id="simStopBtn" disabled>Stoppen</button>
                <button class="modal-btn btn-close" id="simCloseBtn">SchlieÃŸen</button>
            </div>
        </div>
    </div>

    <div class="toast-container" id="toastContainer"></div>

    <img id="pistol" class="pistol" src="images/pistol.png" alt="" draggable="false">

    <div id="crosshair" class="crosshair">
        <svg viewBox="0 0 40 40" width="40" height="40">
            <circle cx="20" cy="20" r="12" fill="none" stroke="currentColor" stroke-width="1.5"/>
            <line x1="20" y1="4" x2="20" y2="14" stroke="currentColor" stroke-width="1.5"/>
            <line x1="20" y1="26" x2="20" y2="36" stroke="currentColor" stroke-width="1.5"/>
            <line x1="4" y1="20" x2="14" y2="20" stroke="currentColor" stroke-width="1.5"/>
            <line x1="26" y1="20" x2="36" y2="20" stroke="currentColor" stroke-width="1.5"/>
            <circle cx="20" cy="20" r="2" fill="currentColor"/>
        </svg>
    </div>

    <script src="js/constants.js"></script>
    <script src="js/datalayer-events.js"></script>
    <script src="js/page-reload-handler.js"></script>
    <script src="js/config-panel.js"></script>
    <script src="js/simulator-panel.js"></script>
    <script src="js/sound.js"></script>
    <script src="js/session-manager.js"></script>
    <script src="js/gun-controller.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
